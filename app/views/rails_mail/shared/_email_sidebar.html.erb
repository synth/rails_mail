<% if defined?(::ActionCable) %>
  <%= rails_mail_turbo_stream_from "rails_mail:emails", channel: "RailsMail::EmailsChannel" %>
<% end %>

<div id="email-sidebar" data-controller="email-highlight">
  <div id="email-list-wrapper">
    <% @emails&.each do |email| %>
      <%= render "rails_mail/shared/email", email: email, email_path: email_path(email) %>
    <% end %>
  </div>
  <% if @pagy.next %>
    <% path_opts = { format: "turbo_stream", page: @pagy.next } %>
    <% path_opts[:q] = params[:q] if params[:q].present? %>
    <%= turbo_frame_tag "email-pagination", src: emails_path(path_opts), loading: "lazy", style: "display: block; height: 50px;" %>
  <% end %>
</div>